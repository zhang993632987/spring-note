# 3.3 集成docker

## 1. 添加docker的Maven插件

```xml
<plugin>
    <groupId>com.spotify</groupId>
    <artifactId>dockerfile-maven-plugin</artifactId>
    <version>1.4.13</version>
    <configuration>
        <repository>${docker.image.prefix}/${project.artifactId}</repository>
        <tag>${project.version}</tag>
        <buildArgs>
            <JAR_FILE>target/${project.build.finalName}.jar</JAR_FILE>
        </buildArgs>
    </configuration>
</plugin>
```

## 2. 添加docker.image.prefix属性值

```xml
<properties>
    <java.version>11</java.version>
    <docker.image.prefix>192.168.10.110:5000</docker.image.prefix>
</properties>
```

除了直接在pom.xml中定义外，还可以在执行maven命令时通过 **-d** 传递docker.image.prefix属性值。

## 3. 编写Dockerfile

{% hint style="warning" %}
Dockerfile文件的存放路径与pom.xml同级！

<img src="../../.gitbook/assets/image (5).png" alt="" data-size="original">
{% endhint %}

```docker
#从包含Java运行时的基本镜像开始
FROM openjdk:11-slim

# 添加维护人员信息
LABEL maintainer="bohan zhang <bohanz838@gmail.com>"

# 应用程序的JAR文件
ARG JAR_FILE
# 将应用程序的JAR文件添加到容器中
COPY ${JAR_FILE} app.jar
# 开放端口
EXPOSE 8080 8081

#执行应用程序
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

## 4. 构建镜像

执行**mvn clean package dockerfile:build**命令构建镜像。

## 5. 生成容器

```bash
$ docker tag 192.168.10.110:5000/cloud-learning:0.0.1-SNAPSHOT cloud-learning:latest
$ docker run -d --name cloud -p 8080:8080 -p 8081:8081 cloud-learning
```
